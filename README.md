# üìö db-innodb-test

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—Å—Ç–∞–≤–∫–∏ –∏ –≤—ã–±–æ—Ä–∫–∏ –≤ MySQL InnoDB —Å —Ä–∞–∑–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ `innodb_flush_log_at_trx_commit`.

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **docker-compose.yml** ‚Äî –ø–æ–¥–Ω—è—Ç–∏–µ MySQL —Å–µ—Ä–≤–µ—Ä–∞
- **app.py** ‚Äî Flask —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ `/insert_user`
- **insert_data_threaded.py** ‚Äî –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é
- **insert_single_row.py** ‚Äî –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è `flush_log`
- **siege —Ç–µ—Å—Ç—ã** ‚Äî –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑ HTTP

---

### 1. –ü–æ–¥–Ω—è—Ç—å MySQL

```bash
docker-compose up -d
```

–û–∂–∏–¥–∞—Ç—å —Å—Ç–∞—Ä—Ç–∞ MySQL —Å–µ—Ä–≤–µ—Ä–∞ (`localhost:3306`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `root`, –ø–∞—Ä–æ–ª—å `root`).

---

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Flask —Å–µ—Ä–≤–µ—Ä

```bash
pip install flask mysql-connector-python faker
python app.py
```
–°–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç –Ω–∞ `http://127.0.0.1:8080`.

---

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—Ç–∞–≤–∫—É –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

```
http://127.0.0.1:8080/insert_user
```

–û—Ç–≤–µ—Ç: `User inserted via GET`.

---

### 4. –ù–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ Siege

–ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã:

```bash
siege -c 5 -r 1000 http://127.0.0.1:8080/insert_user
```

- `-c 5` ‚Äî 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- `-r 1000` ‚Äî –∫–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç 1000 –∑–∞–ø—Ä–æ—Å–æ–≤

---

### 5. –ò–∑–º–µ–Ω–µ–Ω–∏–µ innodb_flush_log_at_trx_commit

–ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
docker exec -it mysql-test mysql -uroot -proot -e "SET GLOBAL innodb_flush_log_at_trx_commit=0;"
```
–∏–ª–∏
```bash
docker exec -it mysql-test mysql -uroot -proot -e "SET GLOBAL innodb_flush_log_at_trx_commit=1;"
```
–∏–ª–∏
```bash
docker exec -it mysql-test mysql -uroot -proot -e "SET GLOBAL innodb_flush_log_at_trx_commit=2;"
```

---

## üìà –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å

### 1. –í—ã–±–æ—Ä–∫–∞ –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è `date_of_birth`

–ó–∞–ø—Ä–æ—Å:

```sql
SELECT * FROM users WHERE date_of_birth BETWEEN '1990-01-01' AND '1991-01-01' LIMIT 100;
```

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- –ë–µ–∑ –∏–Ω–¥–µ–∫—Å–∞
- –° BTREE-–∏–Ω–¥–µ–∫—Å–æ–º
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º InnoDB Adaptive Hash Index

---

### 2. –í—Å—Ç–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ (`insert_data_threaded.py`) –Ω–∞ 1 –º–∏–ª–ª–∏–æ–Ω –∑–∞–ø–∏—Å–µ–π
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –í—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ HTTP —Å–µ—Ä–≤–µ—Ä (`app.py`) + –Ω–∞–≥—Ä—É–∑–∫–∞ `siege`
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–Ω—ã–º–∏ `innodb_flush_log_at_trx_commit`

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å—Ç–∞–≤–∫–∏ —á–µ—Ä–µ–∑ Siege (–ù–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ —Ñ–∞–π–ª–µ insert_results.txt)


**–í—ã–≤–æ–¥:**  
- –ü—Ä–∏ `innodb_flush_log_at_trx_commit=1` —Å–∫–æ—Ä–æ—Å—Ç—å –≤—Å—Ç–∞–≤–∫–∏ –∑–∞–º–µ—Ç–Ω–æ –Ω–∏–∂–µ (–¥–æ ~20%).
- –ü—Ä–∏ `0` –∏ `2` –≤—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±—ã—Å—Ç—Ä–µ–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ.

---

## üìã –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —à–∞–≥–∞–º

```bash
docker-compose up -d
python app.py
siege -c 5 -r 1000 http://127.0.0.1:8080/insert_user
```
–ü–æ–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `innodb_flush_log_at_trx_commit`, –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

